# OSI七层有哪些

* 物理层：确定机械及电气规范，传输**bit**
* 数据链路层：将bit组装成帧，完成**点到点**的传递，传输**帧**，主要有MAC、PPP、HDLC协议
* 网络层：负责数据包的传递和**网际互连**，传输**数据包**，主要有IP、ICMP、ARP协议
* 传输层：提供**端到端**的报文传递，传输**报文**，主要有TCP、UDP协议
* 会话层：建立、管理和终止会话
* 表示层：对数据进行翻译、加密和压缩
* 应用层：通过应用**进程**的交互实现特定网络应用，主要有FTP、HTTP、DNS、SMTP协议

# 浏览器输入url后会发生什么

* 应用层
  * 浏览器分析链接，用**DNS协议**解析服务器ip地址。
  * 首先从本地域名服务器的高速缓存中查询，查询失败，则依次向根域名服务器、顶级域名服务器、权限域名服务器一层层查询。
* 传输层
  * DNS是基于UDP的，因此会用到UDP协议，而HTTP是基于TCP的，因此需要建立**TCP**连接。
  * HTTP1.0建立非持续的TCP连接，HTTP1.1会建立持续的TCP连接。TCP的端口号一般是80。
* 网络层
  * 需要进行路由选择，选择合适的下一跳ip。如果使用了NAT，则经过NAT路由器时需要进行地址转换。
  * 在内部网关中，需要用到RIP协议（基于距离向量）或者OSPF协议（基于链路状态）。
  * 在外部网关中，需要用到BGP协议。
  * 找到ip地址后，需要使用**ARP**协议，将ip地址解析为MAC地址。（本局域网内广播一个ARP请求分组来查询。）
* 数据链路层
  * 得到MAC地址后，经过交换机自学习功能确定转发端口。
* 物理层
  * 剥离帧的封装，传输比特流。

# 传输层

* TCP和UDP

|          |                     TCP                      |        UDP         |
| :------: | :------------------------------------------: | :----------------: |
|  连接性  |                    有连接                    |       无连接       |
|  可靠性  |                     可靠                     |       不可靠       |
| 传输单位 |                   面向字节                   |      面向报文      |
| 首部开销 |                   20 Byte                    |       8 Byte       |
|   功能   | 分用复用、差错校验、可靠传输、拥塞控制、流控 | 分用复用、差错校验 |

* TCP连接的建立与释放
  * 三次握手
    * 连接请求报文不携带数据，但是要消耗一个随机产生的序号x
    * 确认报文不携带数据，同样消耗一个随机产生的序号y
    * 可携带也可不携带数据，不携带数据就不消耗序号，此时连接建立后，第一次发送数据的序号为x+1
  * 四次挥手
    * 客户端发起释放请求，请求结束报文不携带数据，但消耗序号
    * 服务器回复确认，客户端到服务器的连接处于半关闭状态，客户端可以接受数据，但不可以发送
    * 服务器发送完数据后，发起释放请求
    * 客户端回复确认，等2MSL（两个最长报文段寿命）后，彻底断开
* 三次握手可能引发什么问题？为什么？
  * 可能引发洪范攻击
  * 因为服务器端的资源是在第二次握手后分配的，而客户端的资源是在第三次握手后分配的，攻击者可以发送大量第一次握手的数据包，而对服务器的回复ACK不予确认，导致服务器所有的连接处于半挂起状态，消耗服务器资源。
* time_wait和close_wait分别出现在哪一方
  * time_wait：主动关闭连接的一方
  * close_wait：被动关闭的一方

* 握手为什么是三次？
  * 因为在第二次握手中，服务器连接建立请求SYN和对客户端的回复ACK是一起发送的。
* 挥手为什么不能是三次？
  * 因为服务器回复客户端ACK时，服务器还有数据要发送给客户端。
* TCP保证可靠的方式
  * 校验：目的是检测数据在传输中是否发生了变化
  * 序号：保证按序发送，按序到达
  * 确认：TCP使用累计确认，确认按序到达的报文段
  * 重传
    * 超时重传：如果在计时器时间内，未收到ACK，则重传
    * 快速重传：接收到三个冗余ACK时，重传
* TCP的拥塞控制和流量控制
  * 目的不同：拥塞控制控制**量**，流量控制控制**速度**
  * 范围不同：拥塞控制面向**整个网络**，流量控制面向**当前连接**
  * 任务不同：拥塞控制的任务是**发送方根据四个算法检测网络，不断调整拥塞窗口的大小**；流量控制的任务是**动态修改报文中的窗口字段，及时告知发送方接收窗口大小是多少**。
  * 结果相同：最终都是改变了发送窗口（发送窗口=min(拥塞窗口，接受窗口)），从而控制发送方发送数据的速度。

# HTTP（超文本传输协议）

* HTTP过程
  * 用户输入url/点击超链接
  * 浏览器分析url，向DNS服务器请求解析ip地址
  * 服务器进程监听TCP的80端口，客户端进程的端口号由客户端的操作系统动态分配
  * 建立TCP连接，发送文件，释放TCP连接
* HTTP状态码
  * 1xx：临时响应，响应码请求被接受，需要继续处理
  * 2xx：请求已被服务器成功接受处理
  * 3xx：重定向
  * 4xx：客户端发生错误，服务器无法正常处理
  * 5xx：服务器发生错误

* HTTP请求方法
  * GET：请求读取url标识的信息
  * POST：给服务器添加信息
  * HEAD：对HTTP报文进行响应，不返回请求对象，主要作用是调试
  * CONNECT：用于代理服务器