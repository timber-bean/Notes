# 内存管理

C++11中，共有四种存储方式，分别是，自动存储、静态存储、线程存储和动态存储。

## 内存结构

![memory1](F:\Notes\C plus plus\pic\memory1.png)

## 自动存储

定义：在函数中声明的变量（包括函数参数）。

持续性：自动。它们在程序开始执行其所属的函数及代码块时被创建，在执行完函数或代码块时，内存被释放。

作用域：包含它的函数或代码块。

存在位置：栈。

链接性：无，不能被共享。

## 静态存储

定义：在函数定义外定义的变量；使用关键字static定义的变量。

持续性：在程序整个运行过程中都存在。

作用域：与定义的位置有关。

存在位置：静态变量区。

### 链接性

#### 外部链接性

可在其他文件中访问。

##### 定义方式

在代码块外声明，且不加static。

##### 使用方式

**单定义，多声明**。仅在一个文件中定义该变量，其他文件使用时，需要使用extern声明。

#### 内部链接性

只能在当前文件中访问。

##### 定义方式

在代码块外声明，且加static。

#### 无链接性

只能在当前函数或代码块中访问。

##### 定义方式

在代码块内声明，且加static。

## 动态存储

定义：使用new运算符分配的数据。

持续性：动态。一直存在，直到使用delete运算符将其释放或者程序终止。

作用域：受new和delete的控制，有可能是单一文件，也有可能是多个文件。

存在位置：堆。

会导致的问题：堆泄露。原因：在new以后，没有调用delete。解决方法：new和delete配套使用；**C++智能指针**。

## 线程存储

定义：使用thread_local使命的变量。

持续性：和所属线程的生命周期一样长。

## 总结

|    存储描述    | 持续性 | 作用域 | 链接性 |          声明方式          |
| :------------: | :----: | :----: | :----: | :------------------------: |
|    自动存储    |  自动  | 代码块 |   无   |         在代码块中         |
|   寄存器存储   |  自动  | 代码块 |   无   |  在代码块中，使用register  |
|  静态，无链接  |  静态  | 代码块 |   无   |   在代码块中，使用static   |
| 静态，内部链接 |  静态  |  文件  |  内部  | 不在任何函数中，使用static |
| 静态，外部链接 |  静态  |  文件  |  外部  |       不在任何函数中       |

